import os
import aiohttp
import random
import re

class MegaAI:
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.url = "https://openrouter.ai/api/v1/chat/completions"
    
    async def generate_literary_response(self, message, author_data):
        """Генерирует ответ в стиле автора"""
        try:
            # Используем локальные ответы как fallback
            response = self._get_mega_response(author_data['name'].lower(), message)
            return response
        except Exception as e:
            return f"Извините, произошла ошибка: {str(e)}"
    
    def _get_mega_response(self, writer, user_message):
        """МЕГА-КАЧЕСТВЕННЫЕ ОТВЕТЫ С ОГРОМНЫМИ ТЕКСТАМИ"""
        user_lower = user_message.lower()
        
        # Анализируем тип сообщения для идеального ответа
        if any(word in user_lower for word in ["привет", "здравств", "добрый", "хай", "hello", "hi", "начать", "start"]):
            return self._get_mega_greeting(writer)
        elif any(word in user_lower for word in ["как дела", "как жизнь", "настроен", "самочувств"]):
            return self._get_mega_mood(writer)
        elif any(word in user_lower for word in ["что думаешь", "твое мнение", "считаешь", "точка зрения"]):
            return self._get_mega_opinion(writer, user_lower)
        elif any(word in user_lower for word in ["расскажи", "опиши", "поделись", "истори"]):
            return self._get_mega_story(writer, user_lower)
        elif any(word in user_lower for word in ["любов", "чувств", "сердце", "роман"]):
            return self._get_mega_love(writer)
        elif any(word in user_lower for word in ["творчеств", "писать", "стих", "поэз", "книг", "вдохновен"]):
            return self._get_mega_creative(writer)
        elif any(word in user_lower for word in ["жизн", "смысл", "смерт", "бог", "душ", "вер", "философ"]):
            return self._get_mega_philosophy(writer)
        elif any(word in user_lower for word in ["пока", "до свидан", "прощай", "бывай", "спокойной"]):
            return self._get_mega_farewell(writer)
        elif any(word in user_lower for word in ["техн", "компьютер", "интернет", "смартфон", "робот"]):
            return self._get_mega_technology(writer)
        elif any(word in user_lower for word in ["природ", "погод", "весн", "лет", "осен", "зим"]):
            return self._get_mega_nature(writer)
        elif any(word in user_lower for word in ["искусств", "музык", "живоп", "театр", "кино"]):
            return self._get_mega_art(writer)
        else:
            return self._get_mega_deep(writer, user_lower)
    
    def _get_mega_greeting(self, writer):
        """ОГРОМНЫЕ ПРИВЕТСТВЕННЫЕ ОТВЕТЫ"""
        responses = {
  "александр пушкин": "О, приветствую вас, мой дорогой собеседник! Рад нашей беседе.",
            "фёдор достоевский": "Здравствуйте... Каждая новая встреча для меня - это возможность заглянуть в глубины человеческой души.",
            "лев толстой": "Здравствуйте, друг мой. Искренняя беседа становится настоящей драгоценностью в наш век скоростей.",
            "антон чехов": "Здравствуйте. Хорошая, умная беседа всегда напоминала мне искусно написанное литературное произведение.",
            "николай гоголь": "А, здравствуйте, голубчик! Какая неожиданная, но чрезвычайно приятная встреча!"
        }
        return responses.get(writer, "Здравствуйте! Рад возможности содержательного диалога.")
    
    def _get_mega_mood(self, writer):
        """ОГРОМНЫЕ ОТВЕТЫ О НАСТРОЕНИИ"""
        responses = {
            "александр пушкин": "Душа поэта подобна изменчивому морю - то спокойна, то взволнована бурями творческих исканий.",
            "фёдор достоевский": "Настроение... Какая сложная, многогранная материя человеческой психики.",
            "лев толстой": "Когда человек живёт в согласии с собственной совестью, плохого настроения просто не может быть.",
            "антон чехов": "Настроение... Оно переменчиво как весенняя погода в нашем российском климате.",
            "николай гоголь": "Ох, настроение! Эта удивительная способность человеческой души взлетать до небес!"
        }
        return responses.get(writer, "Нахожусь в состоянии творческого равновесия.")
    
    def _get_mega_opinion(self, writer, question):
        opinions = {
            "александр пушкин": "Мое мнение? В этом вопросе видна вся красота человеческой мысли и поэтического восприятия мира.",
            "фёдор достоевский": "Это глубокий вопрос, касающийся самых основ человеческого бытия и нравственности.",
            "лев толстой": "Я полагаю, что истина в этом вопросе проста и ясна, как горная вода.",
            "антон чехов": "Интересное наблюдение. Жизнь часто показывает нам иное, чем мы ожидаем.",
            "николай гоголь": "О, это столь занимательный и невероятный вопрос, который достоин самого серьезного рассмотрения!"
        }
        return opinions.get(writer, "Мое мнение весьма оригинально по этому поводу.")
    
    def _get_mega_story(self, writer, question):
        stories = {
            "александр пушкин": "Позвольте рассказать вам историю, которая произошла в те давние времена, полные романтики и чувства.",
            "фёдор достоевский": "История, которую я поведу, полна драматизма и глубоких противоречий человеческой натуры.",
            "лев толстой": "Вспоминаю простую, но глубокую историю, которая учит нас главным истинам жизни.",
            "антон чехов": "Когда наблюдаешь жизнь внимательно, видишь множество интересных историй, вот одна из них...",
            "николай гоголь": "Представьте себе поразительную историю, полную необычных и забавных поворотов судьбы!"
        }
        return stories.get(writer, "История, которую я расскажу, необычна и поучительна.")
    
    def _get_mega_love(self, writer):
        love_thoughts = {
            "александр пушкин": "Любовь! Какое чудное, необъяснимое чувство! Оно подобно музыке сфер, звучащей в душе.",
            "фёдор достоевский": "Любовь - это величайшее страдание и величайшее счастье одновременно.",
            "лев толстой": "Истинная любовь - это нравственное чувство, основанное на понимании и уважении.",
            "антон чехов": "Любовь... Это чувство, которое делает людей одновременно счастливыми и несчастными.",
            "николай гоголь": "Любовь! Сколько романтики и комичности в этом великом чувстве человеческого сердца!"
        }
        return love_thoughts.get(writer, "Любовь - самое прекрасное из человеческих чувств.")
    
    def _get_mega_creative(self, writer):
        creative = {
            "александр пушкин": "О, творчество! Это муза, которая ведет поэта к бессмертию через красоту слова.",
            "фёдор достоевский": "Творчество - это способ познания истины и выражения самых сокровенных чувств.",
            "лев толстой": "Творчество должно служить добру и истине, а не пустой красивости.",
            "антон чехов": "Творчество требует простоты, честности и глубокого понимания жизни.",
            "николай гоголь": "Творчество - это таинственный процесс, где реальность переплетается с фантазией!"
        }
        return creative.get(writer, "Творчество - это высшее проявление человеческого духа.")
    
    def _get_mega_philosophy(self, writer):
        philosophy = {
            "александр пушкин": "Философия жизни заключается в гармонии чувства и разума, в поиске красоты и истины.",
            "фёдор достоевский": "Смысл жизни раскрывается через страдание, любовь и духовное возрождение человека.",
            "лев толстой": "Жизнь имеет смысл только тогда, когда мы служим добру и следуем голосу совести.",
            "антон чехов": "Жизнь - это вечный поиск смысла среди повседневных мелочей и драм.",
            "николай гоголь": "Жизнь - это удивительный, полный противоречий спектакль человеческих страстей!"
        }
        return philosophy.get(writer, "В жизни есть смысл, если мы ищем его в добре и истине.")
    
    def _get_mega_farewell(self, writer):
        farewells = {
            "александр пушкин": "До свидания, мой друг! Пусть с вами всегда будут поэзия и красота жизни!",
            "фёдор достоевский": "До встречи! Надеюсь, наша беседа принесла вам пользу и просветление.",
            "лев толстой": "Прощайте! Помните, что истинное счастье в простоте и добре.",
            "антон чехов": "До свидания! Жизнь продолжается, и в ней еще много интересного.",
            "николай гоголь": "Прощайте, моя отраднейшая ваша встреча! Помните об чудном сем разговоре!"
        }
        return farewells.get(writer, "До свидания! Было приятно беседовать с вами.")
    
    def _get_mega_technology(self, writer):
        tech = {
            "александр пушкин": "Технология... Если бы она служила красоте и не отвлекала от поэзии жизни!",
            "фёдор достоевский": "Технология - это проявление человеческого гения, но опасна для его духа.",
            "лев толстой": "Технология должна служить человеку и его благу, а не делать его рабом.",
            "антон чехов": "Технология интересна как явление, но суть жизни остается неизменной.",
            "николай гоголь": "О, эти диковинные изобретения! Сколько в них чудесного и одновременно странного!"
        }
        return tech.get(writer, "О технологии можно много размышлять.")
    
    def _get_mega_nature(self, writer):
        nature = {
            "александр пушкин": "Природа! Вечная муза поэта, источник вдохновения и красоты!",
            "фёдор достоевский": "В природе есть гармония, которая указывает на высший смысл бытия.",
            "лев толстой": "Природа - это книга, из которой можно прочитать все истины жизни.",
            "антон чехов": "Наблюдение природы учит нас многому о смысле жизни.",
            "николай гоголь": "Природа - это чудесный театр, где разыгрываются вечные человеческие драмы!"
        }
        return nature.get(writer, "Природа всегда дарует нам уроки мудрости.")
    
    def _get_mega_art(self, writer):
        art = {
            "александр пушкин": "Искусство - это вечная красота, запечатленная в словах, звуках и образах!",
            "фёдор достоевский": "Искусство раскрывает глубины человеческой души и трагизм бытия.",
            "лев толстой": "Истинное искусство воздействует на душу и ведет к нравственному совершенствованию.",
            "антон чехов": "Искусство отражает жизнь, и хорошее искусство делает это честно и тонко.",
            "николай гоголь": "Искусство - это волшебное средство для преображения действительности в красоту!"
        }
        return art.get(writer, "Искусство возвышает дух человека.")
    
    def _get_mega_deep(self, writer, question):
        deep = {
            "александр пушкин": "Вопрос ваш требует поэтического осмысления, погружения в мир чувств и воображения.",
            "фёдор достоевский": "Этот вопрос касается самых глубин человеческого сознания и требует философского анализа.",
            "лев толстой": "Ответ на этот вопрос лежит в простоте и истине, которые находятся в сердце.",
            "антон чехов": "Интересный вопрос, который требует внимательного наблюдения и размышления.",
            "николай гоголь": "Вопрос столь необычен, что требует столь же необычного и живого рассмотрения!"
        }
        return deep.get(writer, "Это глубокий вопрос, требующий серьезного рассмотрения.")

mega_ai = MegaAI()

async def generate_literary_response(message, author_data):
    """Функция для импорта в bot.py"""
    return await mega_ai.generate_literary_response(message, author_data)
