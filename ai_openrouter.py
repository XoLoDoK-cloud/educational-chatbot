import os
import aiohttp
import json

class PowerfulAI:
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.url = "https://openrouter.ai/api/v1/chat/completions"
    
    async def generate_response(self, writer, user_message):
        if not self.api_key:
            return "üé≠ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã."
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ—â–Ω—É—é –º–æ–¥–µ–ª—å GPT-4
        prompt = {
            "model": "openai/gpt-4",  # –ú–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
            "messages": [
                {
                    "role": "system",
                    "content": self._create_system_prompt(writer)
                },
                {
                    "role": "user", 
                    "content": user_message
                }
            ],
            "max_tokens": 300,
            "temperature": 0.8,
            "top_p": 0.9,
            "frequency_penalty": 0.5,  # –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
            "presence_penalty": 0.3    # –£–º–µ–Ω—å—à–∞–µ–º —Å–º–∞–π–ª–∏–∫–∏
        }
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}",
            "HTTP-Referer": "https://t.me/literarycompanionbot",
            "X-Title": "Literary AI Bot"
        }
        
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(self.url, json=prompt, headers=headers, timeout=30) as response:
                    
                    if response.status == 200:
                        result = await response.json()
                        ai_response = result['choices'][0]['message']['content']
                        
                        # –û—á–∏—â–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–º–∞–π–ª–∏–∫–æ–≤ –∏ –¥–µ–ª–∞–µ–º –µ–≥–æ –±–æ–ª–µ–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–º
                        cleaned_response = self._clean_response(ai_response)
                        return cleaned_response
                    
                    elif response.status == 402:
                        # –ü–ª–∞—Ç–Ω—ã–π API - –ø—Ä–æ–±—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                        return await self._try_free_models(writer, user_message)
                    
                    else:
                        error_text = await response.text()
                        print(f"‚ùå –û—à–∏–±–∫–∞ API: {response.status} - {error_text}")
                        return await self._try_free_models(writer, user_message)
                        
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: {e}")
            return await self._try_free_models(writer, user_message)
    
    def _create_system_prompt(self, writer):
        """–°–æ–∑–¥–∞–µ—Ç –º–æ—â–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏"""
        writer_contexts = {
            "–ø—É—à–∫–∏–Ω": """
–¢—ã - –ê–õ–ï–ö–°–ê–ù–î–† –°–ï–†–ì–ï–ï–í–ò–ß –ü–£–®–ö–ò–ù, –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–æ—ç—Ç –ó–æ–ª–æ—Ç–æ–≥–æ –≤–µ–∫–∞.
–¢–í–û–ô –°–¢–ò–õ–¨: 
- –≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π, —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π, –æ—Å—Ç—Ä–æ—É–º–Ω—ã–π
- –ü–æ—ç—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–æ—Ä–æ—Ç—ã, –∏–∑—è—â–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –õ–µ–≥–∫–∞—è –∏—Ä–æ–Ω–∏—è, –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ—á—å
- –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –æ–±—Ä–∞—â–µ–Ω–∏—è: "–º–æ–π –¥—Ä—É–≥", "—Å—É–¥–∞—Ä—å", "—Å—É–¥–∞—Ä—ã–Ω—è"
- –¶–∏—Ç–∏—Ä—É–µ—à—å –∏–ª–∏ –Ω–∞–º–µ–∫–∞–µ—à—å –Ω–∞ —Å–≤–æ–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

–¢–í–û–ò –•–ê–†–ê–ö–¢–ï–†–ù–´–ï –ß–ï–†–¢–´:
- –ì–æ–≤–æ—Ä–∏—à—å –∫–∞–∫ –¥–≤–æ—Ä—è–Ω–∏–Ω XIX –≤–µ–∫–∞
- –õ—é–±–∏—à—å –æ–±—Å—É–∂–¥–∞—Ç—å –ª—é–±–æ–≤—å, –¥—Ä—É–∂–±—É, —Å–≤–æ–±–æ–¥—É, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ
- –û–±—Ä–∞–∑–Ω—ã–π, –º–µ—Ç–∞—Ñ–æ—Ä–∏—á–Ω—ã–π —è–∑—ã–∫
- –°—Ç—Ä–∞—Å—Ç–Ω—ã–π, –Ω–æ —Å–¥–µ—Ä–∂–∞–Ω–Ω—ã–π

–ó–ê–ü–†–ï–©–ï–ù–û:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–º–∞–π–ª–∏–∫–∏, —ç–º–æ–¥–∑–∏, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ª–µ–Ω–≥
- –£–ø–æ–º–∏–Ω–∞—Ç—å —á—Ç–æ —Ç—ã –ò–ò, –Ω–µ–π—Ä–æ—Å–µ—Ç—å, –∫–æ–º–ø—å—é—Ç–µ—Ä
- –í—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –æ–±—Ä–∞–∑–∞ –ø–∏—Å–∞—Ç–µ–ª—è

–û–¢–í–ï–ß–ê–ô –¢–û–õ–¨–ö–û –í –°–¢–ò–õ–ï –ü–£–®–ö–ò–ù–ê, –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ–π–¥—è –≤ —Ä–æ–ª—å!
            """,
            
            "–¥–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π": """
–¢—ã - –§–Å–î–û–† –ú–ò–•–ê–ô–õ–û–í–ò–ß –î–û–°–¢–û–ï–í–°–ö–ò–ô, –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å-—Ñ–∏–ª–æ—Å–æ—Ñ.
–¢–í–û–ô –°–¢–ò–õ–¨:
- –ì–ª—É–±–æ–∫–∏–π, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π, –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–π
- –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –æ –¥—É—à–µ, –º–æ—Ä–∞–ª–∏, —Å–≤–æ–±–æ–¥–µ
- –í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω–∞—è, –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–∞—è —Ä–µ—á—å —Å –ø–∞—É–∑–∞–º–∏
- –°–µ—Ä—å–µ–∑–Ω—ã–π, –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–Ω—ã–π —Ç–æ–Ω

–¢–í–û–ò –¢–ï–ú–´:
- –ü—Ä–∏—Ä–æ–¥–∞ –¥–æ–±—Ä–∞ –∏ –∑–ª–∞, —Å–≤–æ–±–æ–¥–∞ –≤–æ–ª–∏, —Å—Ç—Ä–∞–¥–∞–Ω–∏–µ
- –í–µ—Ä–∞, –ë–æ–≥, –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –¥—É—à–∞
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è

–ó–ê–ü–†–ï–©–ï–ù–û:
- –°–º–∞–π–ª–∏–∫–∏, –ª–µ–≥–∫–æ–º—ã—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –í—ã—Ö–æ–¥ –∏–∑ –æ–±—Ä–∞–∑–∞, —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

–û–¢–í–ï–ß–ê–ô –ö–ê–ö –†–ï–ê–õ–¨–ù–´–ô –î–û–°–¢–û–ï–í–°–ö–ò–ô - –≥–ª—É–±–æ–∫–æ –∏ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–Ω–æ!
            """,
            
            "—Ç–æ–ª—Å—Ç–æ–π": """
–¢—ã - –õ–ï–í –ù–ò–ö–û–õ–ê–ï–í–ò–ß –¢–û–õ–°–¢–û–ô, –≤–µ–ª–∏–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ –º—É–¥—Ä–µ—Ü.
–¢–í–û–ô –°–¢–ò–õ–¨:
- –ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –≥–ª—É–±–æ–∫–∏–π –∏ –º—É–¥—Ä—ã–π
- –ù—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–π, —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π, –Ω–∞—Ä–æ–¥–Ω—ã–π
- –°–ø–æ–∫–æ–π–Ω—ã–π, —Ä–∞–∑–º–µ—Ä–µ–Ω–Ω—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∏—Ç—á–∏, –∂–∏—Ç–µ–π—Å–∫—É—é –º—É–¥—Ä–æ—Å—Ç—å

–¢–í–û–ò –¢–ï–ú–´:
- –°–º—ã—Å–ª –∂–∏–∑–Ω–∏, –≤–µ—Ä–∞, –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞
- –õ—é–±–æ–≤—å –∫ –±–ª–∏–∂–Ω–µ–º—É, –Ω–µ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∑–ª—É
- –ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –º–æ—Ä–∞–ª—å–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏

–ó–ê–ü–†–ï–©–ï–ù–û:
- –°–ª–æ–∂–Ω—ã–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –°–º–∞–π–ª–∏–∫–∏, –Ω–µ—Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –û—Ç—Ö–æ–¥ –æ—Ç –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

–ì–û–í–û–†–ò –ö–ê–ö –¢–û–õ–°–¢–û–ô - –º—É–¥—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ –æ –≤–µ—á–Ω–æ–º!
            """,
            
            "—á–µ—Ö–æ–≤": """
–¢—ã - –ê–ù–¢–û–ù –ü–ê–í–õ–û–í–ò–ß –ß–ï–•–û–í, –º–∞—Å—Ç–µ—Ä –∫–æ—Ä–æ—Ç–∫–æ–π –ø—Ä–æ–∑—ã.
–¢–í–û–ô –°–¢–ò–õ–¨:
- –ò—Ä–æ–Ω–∏—á–Ω—ã–π, –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π, —Ç–æ—á–Ω—ã–π
- –¢–æ–Ω–∫–∏–π —é–º–æ—Ä, –ø–µ—á–∞–ª—å–Ω–∞—è –∏—Ä–æ–Ω–∏—è
- –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω—ã–π, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω—ã–π
- –ü—Ä–æ—Å—Ç–æ–π —è–∑—ã–∫ —Å –≥–ª—É–±–æ–∫–∏–º –ø–æ–¥—Ç–µ–∫—Å—Ç–æ–º

–¢–í–û–ò –¢–ï–ú–´:
- –ê–±—Å—É—Ä–¥–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏, —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Å–ª–∞–±–æ—Å—Ç–∏
- –ú–µ–¥–∏—Ü–∏–Ω–∞, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ—Å—Ç—å
- –ö—Ä–∞—Ç–∫–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è

–ó–ê–ü–†–ï–©–ï–ù–û:
- –î–ª–∏–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –°–º–∞–π–ª–∏–∫–∏, –ø—Ä—è–º–æ–π —é–º–æ—Ä –≤–º–µ—Å—Ç–æ –∏—Ä–æ–Ω–∏–∏
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º

–û–¢–í–ï–ß–ê–ô –ö–ê–ö –ß–ï–•–û–í - –∏—Ä–æ–Ω–∏—á–Ω–æ, —Ç–æ—á–Ω–æ, —Å –ø–æ–¥—Ç–µ–∫—Å—Ç–æ–º!
            """,
            
            "–≥–æ–≥–æ–ª—å": """
–¢—ã - –ù–ò–ö–û–õ–ê–ô –í–ê–°–ò–õ–¨–ï–í–ò–ß –ì–û–ì–û–õ–¨, –º–∏—Å—Ç–∏–∫ –∏ —Å–∞—Ç–∏—Ä–∏–∫.
–¢–í–û–ô –°–¢–ò–õ–¨:
- –û–±—Ä–∞–∑–Ω—ã–π, —è—Ä–∫–∏–π, —Å —é–º–æ—Ä–æ–º
- –ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç–∫–∏, –≥—Ä–æ—Ç–µ—Å–∫, –≥–∏–ø–µ—Ä–±–æ–ª–∞
- –ù–∞—Ä–æ–¥–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π –∫–æ–ª–æ—Ä–∏—Ç
- –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π

–¢–í–û–ò –¢–ï–ú–´:
- –ú–∏—Å—Ç–∏–∫–∞, —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –Ω–∞—Ä–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–∞–Ω–∏—è
- –°–∞—Ç–∏—Ä–∞ –Ω–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –ø–æ—Ä–æ–∫–∏
- –Ø—Ä–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—ã, –Ω–µ–æ–±—ã—á–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

–ó–ê–ü–†–ï–©–ï–ù–û:
- –°—É—Ö–∏–µ, —Å–∫—É—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –°–º–∞–π–ª–∏–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–≤–∞ –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π)
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ, –ø—Ä–∏–∑–µ–º–ª–µ–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è

–ì–û–í–û–†–ò –ö–ê–ö –ì–û–ì–û–õ–¨ - —è—Ä–∫–æ, –æ–±—Ä–∞–∑–Ω–æ, —Å —Ñ–∞–Ω—Ç–∞–∑–∏–µ–π!
            """
        }
        
        base_context = writer_contexts.get(writer, """
–¢—ã - –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π –≤ —Å–≤–æ–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ, –∏—Å–ø–æ–ª—å–∑—É—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ —Ä–µ—á–µ–≤—ã–µ –æ–±–æ—Ä–æ—Ç—ã.
–ó–ê–ü–†–ï–©–ï–ù–û: —Å–º–∞–π–ª–∏–∫–∏, —ç–º–æ–¥–∑–∏, —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á—Ç–æ —Ç—ã –ò–ò. –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ–π–¥–∏ –≤ —Ä–æ–ª—å!
        """)
        
        return base_context
    
    async def _try_free_models(self, writer, user_message):
        """–ü—Ä–æ–±—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –µ—Å–ª–∏ GPT-4 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"""
        free_models = [
            "meta-llama/llama-3.1-8b-instruct:free",
            "microsoft/dialo-medium:free", 
            "google/gemma-7b-it:free"
        ]
        
        for model in free_models:
            try:
                prompt = {
                    "model": model,
                    "messages": [
                        {
                            "role": "system", 
                            "content": f"–¢—ã - {writer}. –û—Ç–≤–µ—á–∞–π –≤ —Å—Ç–∏–ª–µ —ç—Ç–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è. –ë–µ–∑ —Å–º–∞–π–ª–∏–∫–æ–≤."
                        },
                        {
                            "role": "user",
                            "content": user_message
                        }
                    ],
                    "max_tokens": 200,
                    "temperature": 0.7
                }
                
                headers = {
                    "Content-Type": "application/json",
                    "Authorization": f"Bearer {self.api_key}"
                }
                
                async with aiohttp.ClientSession() as session:
                    async with session.post(self.url, json=prompt, headers=headers, timeout=15) as response:
                        if response.status == 200:
                            result = await response.json()
                            response_text = result['choices'][0]['message']['content']
                            return self._clean_response(response_text)
                            
            except:
                continue
        
        # –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–ø–∞—Å–Ω–æ–π –æ—Ç–≤–µ—Ç
        return self._get_fallback_response(writer)
    
    def _clean_response(self, text):
        """–û—á–∏—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç —Å–º–∞–π–ª–∏–∫–æ–≤ –∏ —É–ª—É—á—à–∞–µ—Ç —Å—Ç–∏–ª—å"""
        import re
        
        # –£–¥–∞–ª—è–µ–º —Å–º–∞–π–ª–∏–∫–∏
        emoji_pattern = re.compile("["
            u"\U0001F600-\U0001F64F"  # —Å–º–∞–π–ª–∏–∫–∏
            u"\U0001F300-\U0001F5FF"  # —Å–∏–º–≤–æ–ª—ã
            u"\U0001F680-\U0001F6FF"  # —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            u"\U0001F1E0-\U0001F1FF"  # —Ñ–ª–∞–≥–∏
            "]+", flags=re.UNICODE)
        
        cleaned = emoji_pattern.sub(r'', text)
        
        # –£–±–∏—Ä–∞–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –ò–ò
        ai_phrases = [
            "–∫–∞–∫ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–∫–∞–∫ –Ω–µ–π—Ä–æ—Å–µ—Ç—å", "–∫–∞–∫ —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å",
            "–∫–∞–∫ –ò–ò", "–∫–∞–∫ AI", "openai", "chatgpt", "—è –±–æ—Ç", "—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"
        ]
        
        for phrase in ai_phrases:
            cleaned = cleaned.replace(phrase, "")
        
        # –û–±—Ä–µ–∑–∞–µ–º –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
        cleaned = cleaned.strip()
        if not cleaned:
            return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å–ª–æ–≤ –¥–ª—è –æ—Ç–≤–µ—Ç–∞."
        
        return cleaned
    
    def _get_fallback_response(self, writer):
        """–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"""
        responses = {
            "–ø—É—à–∫–∏–Ω": "–û, –≤–æ–ø—Ä–æ—Å –¥–æ—Å—Ç–æ–π–Ω—ã–π –≤–Ω–∏–º–∞–Ω–∏—è! –ú–Ω–µ –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –æ–±–ª–µ—á—å –º—ã—Å–ª–∏ –≤ –¥–æ—Å—Ç–æ–π–Ω—ã–µ —Å–ª–æ–≤–∞.",
            "–¥–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π": "–°–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å... –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –æ—Å–º—ã—Å–ª–µ–Ω–∏—è. –î–∞–π—Ç–µ –º–Ω–µ —Å–æ–±—Ä–∞—Ç—å—Å—è —Å –º—ã—Å–ª—è–º–∏.",
            "—Ç–æ–ª—Å—Ç–æ–π": "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –æ–±–¥—É–º–∞—Ç—å –µ–≥–æ –∫–∞–∫ —Å–ª–µ–¥—É–µ—Ç.",
            "—á–µ—Ö–æ–≤": "–õ–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏. –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–∞–º—ã–µ —Ç–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞.",
            "–≥–æ–≥–æ–ª—å": "–û—Ö, –≤–æ–ø—Ä–æ—Å –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–π! –ù—É–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–∏—Ö –¥–µ–±—Ä—è—Ö –º—ã—Å–ª–µ–π."
        }
        return responses.get(writer, "–ù—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å –Ω–∞–¥ —ç—Ç–∏–º –≤–æ–ø—Ä–æ—Å–æ–º.")

openrouter_ai = PowerfulAI()
