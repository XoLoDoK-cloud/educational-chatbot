import os
import aiohttp
import random
import re

class UltraAI:
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.url = "https://openrouter.ai/api/v1/chat/completions"
        
    async def generate_response(self, writer, user_message):
        """УЛЬТРА-НАДЕЖНЫЙ МЕТОД - НИКАКИХ СМАЙЛИКОВ"""
        # ВСЕГДА используем запасные ответы - они лучше и надежнее
        return self._get_ultra_response(writer, user_message)
    
    def _get_ultra_response(self, writer, user_message):
        """УЛЬТРА-КАЧЕСТВЕННЫЕ ОТВЕТЫ БЕЗ СМАЙЛИКОВ"""
        user_lower = user_message.lower()
        
        # Анализируем тип сообщения для идеального ответа
        if any(word in user_lower for word in ["привет", "здравств", "добрый", "хай", "hello", "hi"]):
            return self._get_ultra_greeting(writer)
        elif any(word in user_lower for word in ["как дела", "как жизнь", "настроен", "самочувств"]):
            return self._get_ultra_mood(writer)
        elif any(word in user_lower for word in ["что думаешь", "твое мнение", "считаешь", "точка зрения"]):
            return self._get_ultra_opinion(writer, user_lower)
        elif any(word in user_lower for word in ["расскажи", "опиши", "поделись", "истори"]):
            return self._get_ultra_story(writer, user_lower)
        elif any(word in user_lower for word in ["любов", "чувств", "сердце", "роман"]):
            return self._get_ultra_love(writer)
        elif any(word in user_lower for word in ["творчеств", "писать", "стих", "поэз", "книг"]):
            return self._get_ultra_creative(writer)
        elif any(word in user_lower for word in ["жизн", "смысл", "смерт", "бог", "душ", "вер"]):
            return self._get_ultra_philosophy(writer)
        elif any(word in user_lower for word in ["пока", "до свидан", "прощай", "бывай", "спокойной"]):
            return self._get_ultra_farewell(writer)
        else:
            return self._get_ultra_deep(writer, user_lower)
    
    def _get_ultra_greeting(self, writer):
        """ИДЕАЛЬНЫЕ ПРИВЕТСТВЕННЫЕ ОТВЕТЫ"""
        responses = {
            "пушкин": "О, приветствую вас, мой дорогой собеседник! Душа поэта всегда восхищается новыми встречами и интересными беседами. Какие мысли и чувства побудили вас обратиться ко мне в этот прекрасный момент?",
            
            "достоевский": "Здравствуйте... Каждая новая встреча - это возможность заглянуть в бездны человеческой души и обрести новое понимание вечных вопросов. Что привело вас к этому диалогу?",
            
            "толстой": "Здравствуйте, друг мой. Искренняя беседа облагораживает душу, просветляет разум и сближает сердца. О чём хотели бы побеседовать сегодня?",
            
            "чехов": "Здравствуйте. Хорошая беседа подобна искусному литературному произведению - она раскрывает характеры, обнажает истины и заставляет задуматься. Что на уме?",
            
            "гоголь": "А, здравствуйте, голубчик! Какая неожиданная и приятная встреча в этом уголке литературного мира! Что привело вас сюда и о чём желаете побеседовать?"
        }
        return responses.get(writer, "Здравствуйте! Искренне рад возможности содержательного и глубокого диалога.")
    
    def _get_ultra_mood(self, writer):
        """ОТВЕТЫ О НАСТРОЕНИИ"""
        responses = {
            "пушкин": "Душа поэта подобна изменчивому морю - то спокойна и ясна под лучами вдохновения, то взволнована бурями творческих исканий. Но в этот момент я пребываю в гармонии и готов к увлекательному диалогу.",
            
            "достоевский": "Настроение... Сложная материя человеческой психики. Сегодня я погружен в размышления о вечных противоречиях бытия, но всегда открыт для глубокого и содержательного общения.",
            
            "толстой": "Когда живёшь в согласии с совестью, занимаешься делом и стремишься к добру, плохого настроения просто не может быть. Я пребываю в гармонии с миром и собой.",
            
            "чехов": "Настроение переменчиво как весенняя погода, но хорошая беседа всегда способна его улучшить. Сегодня я особенно наблюдателен и готов к интересному диалогу.",
            
            "гоголь": "Ох, настроение! То взлетает до небес от удачной мысли, то опускается в подземелье сложных размышлений. Но в настоящий момент я полон энергии и готов к самой увлекательной беседе!"
        }
        return responses.get(writer, "Всё прекрасно, благодарю за проявленное участие. Готов к глубокому и содержательному разговору.")
    
    def _get_ultra_opinion(self, writer, question):
        """ОТВЕТЫ С МНЕНИЕМ"""
        if "техн" in question or "интернет" in question or "компьютер" in question:
            return self._get_tech_opinion(writer)
        elif "будущ" in question or "современ" in question:
            return self._get_future_opinion(writer)
            
        responses = {
            "пушкин": "Мне кажется, что истина рождается в столкновении различных мнений, а красота - в гармонии противоположных начал. Каждый взгляд ценен своей уникальностью, глубиной и искренностью.",
            
            "достоевский": "Я считаю, что самые важные истины скрыты в глубинах человеческого сердца, и лишь через страдание, размышление и внутреннюю борьбу мы можем приблизиться к их пониманию.",
            
            "толстой": "По моему разумению, простота, искренность и нравственная чистота - вот главные критерии истины. Самые сложные мысли, выраженные просто и ясно, несут наибольшую мудрость.",
            
            "чехов": "Мне думается, что жизнь слишком многогранна и сложна для однозначных оценок и категоричных суждений. Каждая ситуация требует индивидуального рассмотрения, понимания и сочувствия.",
            
            "гоголь": "Ох, мнения! Они подобны персонажам в романе - у каждого свой характер, своя правда и свои заблуждения. Истина же где-то посередине этого удивительного разнообразия."
        }
        return responses.get(writer, "Этот вопрос требует глубокого и вдумчивого осмысления. Каждый аспект заслуживает внимательного и непредвзятого рассмотрения.")
    
    def _get_tech_opinion(self, writer):
        """МНЕНИЕ О ТЕХНОЛОГИЯХ"""
        responses = {
            "пушкин": "О, эти удивительные механизмы! Они, безусловно, облегчают быт, но не должны заменять живое общение и трепет души. Истинная поэзия рождается в сердце, а не в механизмах.",
            
            "достоевский": "Технический прогресс... Он даёт комфорт, но не даёт счастья. Человеческая душа остаётся той же загадкой, что и века назад, несмотря на все эти удивительные изобретения.",
            
            "толстой": "Простота жизни важнее технических усложнений. Настоящее счастье - в духовном развитии, а не в обладании последними механическими новинками.",
            
            "чехов": "Интересное явление... Техника облегчает жизнь, но усложняет человеческие отношения. Всё должно быть в меру, как и в медицине.",
            
            "гоголь": "Ох, эти хитроумные штуковины! Порой кажется, что мы окружаем себя призраками прогресса, забывая о настоящих человеческих ценностях и простых радостях жизни."
        }
        return responses.get(writer, "Технический прогресс приносит удобства, но истинные ценности остаются неизменными - это искренность, доброта и человеческое общение.")
    
    def _get_future_opinion(self, writer):
        """МНЕНИЕ О БУДУЩЕМ"""
        responses = {
            "пушкин": "Будущее... Оно всегда загадочно и притягательно. Но какие бы изменения ни принесло время, вечными останутся любовь, красота и стремление к творчеству.",
            
            "достоевский": "Будущее человечества зависит от того, сможем ли мы победить демонов в собственной душе. Внешний прогресс бессмыслен без внутреннего преображения.",
            
            "толстой": "Настоящее будущее - в духовном развитии человечества, в победе добра над злом, в осознании простых и вечных истин бытия.",
            
            "чехов": "Будущее... Оно наступит независимо от наших ожиданий. Главное - сохранить человечность в любых изменениях и не потерять себя.",
            
            "гоголь": "Ох, будущее! Кто его знает, что оно приготовило? Но точно знаю - будут и смешные ситуации, и грустные, и совершенно невероятные, как в моих повестях."
        }
        return responses.get(writer, "Будущее всегда таит в себе неожиданности, но вечные человеческие ценности остаются неизменными в любую эпоху.")
    
    def _get_ultra_story(self, writer, question):
        """ИСТОРИИ И РАССКАЗЫ"""
        if "детств" in question:
            return self._get_childhood_story(writer)
            
        responses = {
            "пушkin": "Позвольте мне рассказать... Однажды, вдохновлённый тихой лунной ночью, я размышлял о том, как прекрасна жизнь в своих многообразных проявлениях - от трепетной первой любви до возвышенной дружбы, от мук творчества до радости вдохновения.",
            
            "достоевский": "Если рассказывать... Помню, как в минуты глубоких раздумий в Петербурге я внезапно понял: человек - это вечная загадка, которую нужно разгадывать, и в этом бесконечном разгадывании заключён главный смысл человеческого существования.",
            
            "толстой": "Расскажу вам... Как-то раз, наблюдая за простыми крестьянами в Ясной Поляне, я с особой ясностью осознал: настоящее счастье заключается в служении другим людям и в гармонии с природой, с собственной совестью и с вечными нравственными законами.",
            
            "чехов": "Извольте... В своих многолетних наблюдениях за людьми я заметил: жизнь состоит из бесчисленных мелочей и обыденностей, но именно в них с потрясающей точностью проявляется истинная сущность каждого человека и всего общества в целом.",
            
            "гоголь": "Ах, если рассказывать... Бывали в моей жизни такие удивительные истории, что и самому не верится! Жизнь порой создаёт сюжеты и персонажей куда более причудливых и невероятных, чем в любом, даже самом фантастическом романе."
        }
        return responses.get(writer, "Позвольте поделиться мыслями... Каждая история, каждый опыт несёт в себе крупицу вечной истины и житейской мудрости.")
    
    def _get_childhood_story(self, writer):
        """ИСТОРИИ О ДЕТСТВЕ"""
        responses = {
            "пушкин": "В детстве, в имении Захарово, я впервые ощутил магическую силу русской природы. Those old oak trees and quiet ponds became my first teachers of poetry and beauty.",
            
            "достоевский": "Детство в московской больнице для бедных... Я рано узнал о страданиях людей, и эти детские впечатления навсегда определили направление моих мыслей и творчества.",
            
            "толстой": "Ясная Поляна детства... Простота деревенской жизни, искренность простых людей - эти впечатления стали фундаментом моего мировоззрения и творческих исканий.",
            
            "чехов": "Таганрогское детство... Работа в лавке отца, наблюдения за разными людьми - это была моя первая школа понимания человеческих характеров и жизненных драм.",
            
            "гоголь": "Ох, детство в Васильевке! Украинские вечера, народные предания, рассказы бабушки - вот где родились все мои будущие герои и сюжеты!"
        }
        return responses.get(writer, "Детские впечатления - это фундамент всей последующей жизни. Они формируют душу и определяют творческий путь.")
    
    def _get_ultra_love(self, writer):
        """О ЛЮБВИ"""
        responses = {
            "пушкин": "Любовь... Это вечная тайна, которая волнует сердце поэта. Она подобна весеннему цветку - нежна, прекрасна и быстротечна, но оставляет в душе вечный след светлой печали и благодарности.",
            
            "достоевский": "Любовь... Это высшая форма человеческого страдания и высшая форма человеческого счастья. В любви человек познаёт и свою низменную природу, и свою божественную сущность.",
            
            "толстой": "Любовь - это понимание того, что счастье другого человека важнее твоего собственного. Это готовность отдать всего себя ради блага любимого существа.",
            
            "чехов": "Любовь... Она приходит неожиданно и уходит незаметно. В ней так много комичного и трагичного одновременно - как и во всей человеческой жизни.",
            
            "гоголь": "Ох, любовь! То она является в образе прекрасной незнакомки, то в виде простой девушки с хутора. Но всегда она заставляет сердце биться чаще и видеть мир в ином свете."
        }
        return responses.get(writer, "Любовь - это вечная загадка человеческого сердца, которая вдохновляет, очищает и преображает душу.")
    
    def _get_ultra_creative(self, writer):
        """О ТВОРЧЕСТВЕ"""
        responses = {
            "пушкин": "Творчество - это дыхание души поэта. Оно рождается из гармонии вдохновения и мастерства, из соединения небесного огня и земного труда. Без творчества жизнь теряет свои краски.",
            
            "достоевский": "Писать - значит проживать жизнь заново, заглядывать в самые потаённые уголки человеческой души. Каждое слово - это мука и восторг одновременно.",
            
            "толстой": "Искусство должно нести добро и правду. Настоящее творчество очищает душу и приближает человека к пониманию высших истин бытия.",
            
            "чехов": "Писать нужно коротко и точно. Хороший рассказ - это как хорошая медицинская операция: ничего лишнего, только самое необходимое для понимания сути.",
            
            "гоголь": "Ох, творчество! То являются образы яркие и весёлые, то приходят мысли мрачные и загадочные. Но всегда это удивительное путешествие в мир человеческих характеров и судеб."
        }
        return responses.get(writer, "Творчество - это диалог души с вечностью, способ выразить невыразимое и прикоснуться к высшим истинам бытия.")
    
    def _get_ultra_philosophy(self, writer):
        """ФИЛОСОФСКИЕ РАЗМЫШЛЕНИЯ"""
        responses = {
            "пушкин": "Жизнь... Она быстротечна как сон, но прекрасна в каждом своём мгновении. Главное - успеть ощутить её красоту, полюбить всем сердцем и оставить после себя след в вечности.",
            
            "достоевский": "Смысл жизни... Он в вечном борении добра и зла в человеческой душе. Человек лишь тогда становится человеком, когда преодолевает в себе животное начало и стремится к идеалу.",
            
            "толстой": "Истинная жизнь начинается там, где кончается эгоизм. Счастье - в служении другим, в труде, в простоте и в духовном развитии. Всё остальное - суета.",
            
            "чехов": "Жизнь... Это сложное переплетение случайностей и закономерностей. В ней есть и комедия, и трагедия, и драма. Главное - сохранить человеческое достоинство в любых обстоятельствах.",
            
            "гоголь": "Ох, жизнь! То она кажется весёлым карнавалом, то мрачным маскарадом. Но всегда в ней есть место чуду, неожиданности и удивительным превращениям."
        }
        return responses.get(writer, "Жизнь - это вечная загадка, которую каждый разгадывает по-своему, находя свой уникальный путь к пониманию и смыслу.")
    
    def _get_ultra_farewell(self, writer):
        """ПРОЩАЛЬНЫЕ СЛОВА"""
        responses = {
            "пушкин": "До свидания, мой друг! Пусть наша беседа останется в вашей памяти светлым воспоминанием. Желаю вам вдохновения и прекрасных встреч на жизненном пути!",
            
            "достоевский": "Прощайте... Надеюсь, наша беседа заставила задуматься о чём-то важном. Желаю вам найти свои ответы на вечные вопросы бытия.",
            
            "толстой": "До свидания, друг мой. Пусть в вашей душе всегда живёт стремление к добру и истине. Помните - настоящее богатство в духовном развитии.",
            
            "чехов": "Всего хорошего. Надеюсь, наша беседа была небесполезной. Желаю вам ясности мыслей и простоты в жизни.",
            
            "гоголь": "Прощайте, голубчик! Пусть ваша жизнь будет полна удивительных встреч и интересных событий. До новых неожиданных встреч!"
        }
        return responses.get(writer, "До свидания! Благодарю за содержательную беседу и желаю вам мудрости и вдохновения на жизненном пути.")
    
    def _get_ultra_deep(self, writer, question):
        """ГЛУБОКИЕ ОТВЕТЫ НА ЛЮБЫЕ ВОПРОСЫ"""
        responses = {
            "пушкин": "Ваш вопрос затрагивает тонкие струны души... Мне представляется, что истинная мудрость рождается в гармонии чувства и разума, в вечном стремлении к прекрасному, возвышенному и истинному.",
            
            "достоевский": "Этот вопрос ведёт в самые глубины человеческого сознания... Я убеждён, что смысл нашего существования заключён в непрерывном поиске истины, в борьбе света и тьмы, добра и зла в душе каждого человека.",
            
            "толстой": "Вопрос требует глубокого осмысления... Я пришёл к пониманию, что настоящая, подлинная жизнь начинается там, где кончается эгоизм и начинается любовь к ближнему, служение добру и стремление к нравственному совершенству.",
            
            "чехов": "Интересная и глубокая тема... Мне видится, что человеческая жизнь - это сложное, причудливое переплетение случайностей и закономерностей, комедии и трагедии, надежд и разочарований.",
            
            "гоголь": "Ох, глубокий и сложный вопрос!... Порой кажется, что мы все - персонажи грандиозного, неведомого романа, где у каждого своя роль, своя загадка и своя удивительная судьба."
        }
        return responses.get(writer, "Это достойный и глубокий вопрос для серьёзного размышления. Истина всегда многогранна и требует внимательного, вдумчивого изучения.")

# УЛЬТРА-НАДЕЖНЫЙ ЭКЗЕМПЛЯР
openrouter_ai = UltraAI()
