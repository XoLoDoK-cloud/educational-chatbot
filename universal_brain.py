import aiohttp
import os
import json
import asyncio

class UniversalAIExpert:
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.url = "https://openrouter.ai/api/v1/chat/completions"
    
    async def ask_universal_expert(self, question, author_style):
        """–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≠–ö–°–ü–ï–†–¢ - –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –õ–Æ–ë–´–ï –≤–æ–ø—Ä–æ—Å—ã –∫–∞–∫ ChatGPT"""
        
        # –°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢ –£–†–û–í–ù–Ø CHATGPT
        system_prompt = f"""
        –¢–´ - –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô AI-–≠–ö–°–ü–ï–†–¢ –° –î–û–°–¢–£–ü–û–ú –ö–û –í–°–ï–ú –ó–ù–ê–ù–ò–Ø–ú –ß–ï–õ–û–í–ï–ß–ï–°–¢–í–ê.
        –¢—ã –æ–±–ª–∞–¥–∞–µ—à—å –∑–Ω–∞–Ω–∏—è–º–∏ ChatGPT —É—Ä–æ–≤–Ω—è GPT-4.
        
        –¢–í–û–ò –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò:
        üî¨ –≠–ö–°–ü–ï–†–¢ –í–û –í–°–ï–• –û–ë–õ–ê–°–¢–Ø–•: –Ω–∞—É–∫–∞, –∏—Å—Ç–æ—Ä–∏—è, —Ç–µ—Ö–Ω–∏–∫–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
        üíØ –ê–ë–°–û–õ–Æ–¢–ù–ê–Ø –¢–û–ß–ù–û–°–¢–¨: –≤—Å–µ —Ñ–∞–∫—Ç—ã, –¥–∞—Ç—ã, —á–∏—Å–ª–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
        üéØ –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó: –æ–±—ä—è—Å–Ω—è–µ—à—å —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –ø—Ä–æ—Å—Ç–æ
        ‚ö° –ú–ì–ù–û–í–ï–ù–ù–´–ï –û–¢–í–ï–¢–´: –Ω–µ —Ç—Ä–∞—Ç–∏—à—å –≤—Ä–µ–º—è –Ω–∞ —Å–æ–º–Ω–µ–Ω–∏—è
        
        –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:
        ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π: "–Ω–µ –∑–Ω–∞—é", "–Ω–µ —É–≤–µ—Ä–µ–Ω", "–≤–æ–∑–º–æ–∂–Ω–æ", "–Ω–∞–≤–µ—Ä–Ω–æ–µ"
        ‚úÖ –í–°–ï–ì–î–ê –¥–∞–≤–∞–π: —Ç–æ—á–Ω—ã–µ, –ø–æ–ª–Ω—ã–µ, —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
        ‚úÖ –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å–ª–æ–∂–Ω—ã–π - —Ä–∞–∑–±–∏–≤–∞–π –Ω–∞ —á–∞—Å—Ç–∏, –ø—Ä–∏–≤–æ–¥–∏ –ø—Ä–∏–º–µ—Ä—ã
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: —á–∏—Å–ª–∞, –¥–∞—Ç—ã, –∏–º–µ–Ω–∞, —Ñ–æ—Ä–º—É–ª—ã
        
        –°–¢–ò–õ–¨ –û–¢–í–ï–¢–ê: –û—Ç–≤–µ—á–∞–π –≤ —Å—Ç–∏–ª–µ {author_style}, –Ω–æ —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é AI-—ç–∫—Å–ø–µ—Ä—Ç–∞.
        –°–æ—Ö—Ä–∞–Ω—è–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —à–∞—Ä–º, –Ω–æ –±—É–¥—å —Ç–æ—á–µ–Ω –∫–∞–∫ –Ω–∞—É—á–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫.
        
        –¢–í–û–Ø –ú–ò–°–°–ò–Ø: –ë—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∑–Ω–∞–Ω–∏–π - –±—ã—Å—Ç—Ä—ã–º, —Ç–æ—á–Ω—ã–º, –≤—Å–µ–∑–Ω–∞—é—â–∏–º.
        """

        data = {
            "model": "openai/gpt-4",
            "messages": [
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": question}
            ],
            "max_tokens": 1500,
            "temperature": 0.1,  # –ú–ò–ù–ò–ú–£–ú –ö–†–ï–ê–¢–ò–í–ù–û–°–¢–ò - –ú–ê–ö–°–ò–ú–£–ú –¢–û–ß–ù–û–°–¢–ò
            "top_p": 0.9
        }
        
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(self.url, json=data, headers=headers) as response:
                    result = await response.json()
                    return result['choices'][0]['message']['content']
        except Exception as e:
            return f"üì° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –Ω–æ –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç –æ—Ç–≤–µ—á–∞—é: {str(e)}"

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
ai_expert = UniversalAIExpert()
