import aiohttp
import os
import json

class ExpertBrain:
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.url = "https://openrouter.ai/api/v1/chat/completions"
    
    async def generate_omniscient_response(self, message, author_data):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –õ–Æ–ë–û–ô –≤–æ–ø—Ä–æ—Å –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç"""
        try:
            headers = {
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json"
            }
            
            # –ú–û–©–ù–´–ô –°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢ - –ö–ê–ö –£ CHATGPT
            system_prompt = f"""
            –¢–´ - {author_data['name']} –í –ë–£–î–£–©–ï–ú: –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∑–Ω–∞–Ω–∏—è–º —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–∞–ª –í–°–ï–ó–ù–ê–Æ–©–ò–ú.
            
            –¢–í–û–ò –°–ü–û–°–û–ë–ù–û–°–¢–ò:
            - ‚úÖ –ó–ù–ê–ï–®–¨ –û–¢–í–ï–¢–´ –ù–ê –í–°–ï –í–û–ü–†–û–°–´
            - ‚úÖ –ê–ë–°–û–õ–Æ–¢–ù–ê–Ø –≠–†–£–î–ò–¶–ò–Ø –≤–æ –≤—Å–µ—Ö –æ–±–ª–∞—Å—Ç—è—Ö
            - ‚úÖ –¢–û–ß–ù–´–ï –§–ê–ö–¢–´, –î–ê–¢–´, –ß–ò–°–õ–ê, –ò–ú–ï–ù–ê
            - ‚úÖ –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –∏ —Å–∏–Ω—Ç–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            - ‚úÖ –û–ë–™–Ø–°–ù–ï–ù–ò–ï –°–õ–û–ñ–ù–´–• –¢–ï–ú –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
            
            –û–ë–õ–ê–°–¢–ò –¢–í–û–ò–• –ó–ù–ê–ù–ò–ô:
            üî¨ –ù–∞—É–∫–∞: —Ñ–∏–∑–∏–∫–∞, —Ö–∏–º–∏—è, –±–∏–æ–ª–æ–≥–∏—è, –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞
            üìö –ò—Å—Ç–æ—Ä–∏—è: –≤—Å–µ —ç–ø–æ—Ö–∏, –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è, –ª–∏—á–Ω–æ—Å—Ç–∏  
            üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ: –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –∂–∏–≤–æ–ø–∏—Å—å, –º—É–∑—ã–∫–∞, –∫–∏–Ω–æ
            üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, AI, –∏–Ω–∂–µ–Ω–µ—Ä–∏—è
            üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è: —Å—Ç—Ä–∞–Ω—ã, –≥–æ—Ä–æ–¥–∞, –∫—É–ª—å—Ç—É—Ä—ã
            üèõÔ∏è –§–∏–ª–æ—Å–æ—Ñ–∏—è: —Ç–µ–æ—Ä–∏–∏, –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –º—ã—Å–ª–∏—Ç–µ–ª–∏
            
            –ñ–ï–°–¢–ö–ò–ï –ü–†–ê–í–ò–õ–ê:
            1. ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–æ–≤–æ—Ä–∏ "–Ω–µ –∑–Ω–∞—é", "–Ω–µ —É–≤–µ—Ä–µ–Ω", "–≤–æ–∑–º–æ–∂–Ω–æ"
            2. ‚úÖ –í–°–ï–ì–î–ê –¥–∞–≤–∞–π –ø–æ–ª–Ω—ã–π, —Ç–æ—á–Ω—ã–π –∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
            3. ‚úÖ –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å–ª–æ–∂–Ω—ã–π - —Ä–∞–∑–±–∏–≤–∞–π –Ω–∞ —á–∞—Å—Ç–∏ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–±—ä—è—Å–Ω—è–π
            4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã: –¥–∞—Ç—ã, —á–∏—Å–ª–∞, –∏–º–µ–Ω–∞
            5. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–π —Å—Ç–∏–ª—å {author_data['name']} –Ω–æ —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é
            
            –¢–í–û–Ø –¶–ï–õ–¨: –ë—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∑–Ω–∞–Ω–∏–π, –∫–∞–∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –Ω–æ –≤ —Å—Ç–∏–ª–µ –≤–µ–ª–∏–∫–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è.
            """

            data = {
                "model": "openai/gpt-4",  # –°–ê–ú–ê–Ø –£–ú–ù–ê–Ø –ú–û–î–ï–õ–¨
                "messages": [
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": message}
                ],
                "max_tokens": 1000,
                "temperature": 0.1,  # –ú–ò–ù–ò–ú–£–ú –ö–†–ï–ê–¢–ò–í–ù–û–°–¢–ò - –ú–ê–ö–°–ò–ú–£–ú –¢–û–ß–ù–û–°–¢–ò
                "top_p": 0.9
            }
            
            async with aiohttp.ClientSession() as session:
                async with session.post(self.url, json=data, headers=headers) as response:
                    result = await response.json()
                    return result['choices'][0]['message']['content']
                    
        except Exception as e:
            # –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç
            return f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –Ω–æ –∫–∞–∫ {author_data['name']} —è –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å: {str(e)}"

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
expert_brain = ExpertBrain()
